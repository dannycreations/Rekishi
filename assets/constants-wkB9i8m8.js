const h=e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),f=e=>{if(e.length<=2)return{regex:null,error:null};const t=e.slice(1,-1);if(!t)return{regex:null,error:null};try{return{regex:new RegExp(t,"i"),error:null}}catch(r){return console.error("Invalid regex provided:",r),{regex:null,error:"Invalid regular expression."}}},m=e=>{const t=e.trim();return t.length>2&&t.startsWith("/")&&t.endsWith("/")},p=e=>{if(!e)return"";try{return new URL(e).hostname.replace(/^www\./,"")}catch{const t=e.match(/:\/\/([^/?#:]+)/);return t?.[1]?t[1].replace(/^www\./,""):""}},u=(e,t,r)=>{if(!e)return r;try{const s=JSON.parse(e);return s.state?t(s.state):r}catch(s){return console.error("Failed to parse state from storage",s),r}},S=e=>h(e).replace(/\\\*/g,".*"),y=e=>{const t=new Set,r=[],s=[];for(const n of e)if(n.isRegex)try{new RegExp(n.value),s.push(`(${n.value})`)}catch(i){console.error(`Invalid regex in blacklist, skipping: ${n.value}`,i)}else if(n.value.includes("*")){const i=S(n.value);if(n.value.includes("/"))if(i.endsWith("/.*")){const c=i.slice(0,-3);s.push(`(^${c}(\\/.*)?$)`)}else s.push(`(^${i})`);else r.push(`(^${i}$)`)}else t.add(n.value);const o=r.length>0?new RegExp(r.join("|"),"i"):null,a=s.length>0?new RegExp(s.join("|"),"i"):null;return{plain:t,domainRegex:o,urlRegex:a}},E=(e,t)=>{if(!e)return!1;const r=p(e);if(t.plain.has(r)||t.domainRegex&&t.domainRegex.test(r))return!0;if(t.urlRegex){let s="/";try{s=new URL(e).pathname}catch{const a=e.match(/^[^/:]+([/][^?#]*)/);s=a?a[1]:"/"}const o=r+s;if(t.urlRegex.test(o))return!0}return!1},R=e=>{const t=e.trim();if(!t)return null;const r=m(t),s=r?t.slice(1,-1):t;if(!s)return null;if(r)try{new RegExp(s)}catch{return{error:"Invalid Regular Expression"}}return{value:s,isRegex:r}},x=e=>u(e,t=>t.blacklistedItems??[],[]),d=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),w=e=>{const t=e.toLocaleDateString("en-US",{weekday:"long"}),r=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}, ${r}/${s}/${o}`},I=e=>{const t=new Date(e);t.setHours(0,0,0,0);const r=new Date(e);return r.setHours(23,59,59,999),{startTime:t.getTime(),endTime:r.getTime()}},T=e=>{const t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0");return`${t}/${r}/${s}`},D=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),_=e=>({id:`${e.id}-${e.lastVisitTime}`,url:e.url??"",title:e.title??e.url??"",lastVisitTime:e.lastVisitTime??0,visitCount:e.visitCount??0,typedCount:e.typedCount??0}),v=(e,t,r,s)=>{if(r){if(s.error)return{items:[],error:s.error};if(s.regex){const a=s.regex;return{items:e.filter(n=>a.test(n.title)||a.test(n.url))}}return{items:[]}}const o=t.toLowerCase();return{items:e.filter(a=>(a.title??"").toLowerCase().includes(o)||(a.url??"").toLowerCase().includes(o))}},$=e=>{if(!e||e.length===0)return[];const t=[];let r=null,s=null,o=-1;for(const a of e){const n=new Date(a.lastVisitTime);if(!r||!d(n,r.date)){const c=new Date(n);c.setHours(0,0,0,0),r={date:c,items:[],hourlyGroups:[]},t.push(r),o=-1}r.items.push(a);const i=n.getHours();if(i!==o){o=i;const c=new Date(n);c.setMinutes(0,0,0),s={time:c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),items:[]},r.hourlyGroups.push(s)}s&&s.items.push(a)}return t},l={dataRetention:"disabled"},k=e=>u(e,t=>({dataRetention:t.dataRetention??l.dataRetention}),{...l}),g=e=>{const t=typeof chrome<"u"&&chrome.storage?chrome.storage[e]:void 0;return{getItem:async r=>{if(t)try{const o=(await t.get([r]))[r];return typeof o=="string"?o:null}catch(s){return console.error(`Failed to read from chrome.storage.${e}`,s),localStorage.getItem(r)}return localStorage.getItem(r)},setItem:async(r,s)=>{if(t)try{await t.set({[r]:s})}catch(o){console.error(`Failed to write to chrome.storage.${e}`,o),localStorage.setItem(r,s)}else localStorage.setItem(r,s)},removeItem:async r=>{if(t)try{await t.remove([r])}catch(s){console.error(`Failed to remove from chrome.storage.${e}`,s),localStorage.removeItem(r)}else localStorage.removeItem(r)}}},A=g("local"),L=g("sync"),C={blacklist:"Blacklist",export:"Export",settings:"Settings"},H={blacklist:"lg",export:"md",settings:"lg"},F="rekishi-blacklist",G="rekishi-history",Y="rekishi-setting",O="rekishi-cleanup",N="rekishi-retention",b="blacklist-cleaner",K=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],M=500,U=100,B=20;export{F as B,b as C,K as D,G as H,B as I,N as R,Y as S,C as V,k as a,O as b,y as c,l as d,L as e,R as f,I as g,d as h,E as i,T as j,$ as k,A as l,_ as m,h as n,m as o,x as p,p as q,D as r,w as s,f as t,U as u,M as v,v as w,H as x};
